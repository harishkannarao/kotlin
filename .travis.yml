sudo: required
dist: xenial

language: java

jdk:
  - openjdk11

services:
  - docker

install:
  - sudo apt-get -qq update
  - sudo apt-get -qq install -y chromium-browser
  - sudo apt-get -qq install -y chromium-chromedriver

before_script:
  - docker --version
  - docker-compose --version
  - ./gradlew pullDocker --info
  - ./gradlew clean minifyFiles assemble copyAppToDocker
  - ./gradlew startDocker --info

script:
  - ./gradlew clean minifyFiles assemble
  - ./gradlew build --info -DchromeDriverBinary=/usr/lib/chromium-browser/chromedriver -DchromeBinary=/usr/bin/chromium-browser -DchromeHeadless=true -Dapp.enable.call.trace=false
  - ./gradlew build --info -Dapp.development.mode=false -Dapp.enable.call.trace=false -DchromeDriverBinary=/usr/lib/chromium-browser/chromedriver -DchromeBinary=/usr/bin/chromium-browser -DchromeHeadless=true
  - ./gradlew :ktor:generateLicenseReport

after_script:
  - ./gradlew stopDocker --info